/* ===== Theme Variables ===== */
:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --primary-glow: rgba(99,102,241,0.35);
  --accent: #f472b6;
  --accent-2: #38bdf8;
  --success: #22c55e;
  --success-bg: rgba(34,197,94,0.12);
  --warning: #f59e0b;
  --warning-bg: rgba(245,158,11,0.12);
  --danger: #ef4444;
  --danger-bg: rgba(239,68,68,0.1);

  --bg-body: #f0f2ff;
  --bg-card: #ffffff;
  --bg-card-alt: #f8f9fe;
  --bg-glass: rgba(255,255,255,0.7);
  --bg-input: #f1f3f9;
  --text-1: #1e1b4b;
  --text-2: #64748b;
  --text-3: #a1a1aa;
  --border: rgba(0,0,0,0.06);
  --shadow-card: 0 2px 8px rgba(99,102,241,0.08), 0 8px 32px rgba(99,102,241,0.06);
  --shadow-float: 0 8px 30px rgba(99,102,241,0.18);
  --shadow-glow: 0 0 40px var(--primary-glow);
}

[data-theme="dark"] {
  --bg-body: #0c0a1d;
  --bg-card: #1a1836;
  --bg-card-alt: #221f42;
  --bg-glass: rgba(26,24,54,0.8);
  --bg-input: #2a2650;
  --text-1: #f1f0ff;
  --text-2: #a5a3c9;
  --text-3: #6e6b8a;
  --border: rgba(255,255,255,0.06);
  --shadow-card: 0 2px 8px rgba(0,0,0,0.3), 0 8px 32px rgba(0,0,0,0.2);
  --shadow-float: 0 8px 30px rgba(99,102,241,0.25);
}

/* ===== Reset ===== */
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{font-size:16px;-webkit-tap-highlight-color:transparent}
body{
  font-family:'Rubik',system-ui,sans-serif;
  background:var(--bg-body);
  color:var(--text-1);
  min-height:100vh;min-height:100dvh;
  overflow:hidden;
}
.hidden{display:none!important}
button{font-family:inherit;cursor:pointer}

/* ===== Ambient Background ===== */
.ambient-bg{position:fixed;inset:0;z-index:0;overflow:hidden;pointer-events:none}
.ambient-orb{position:absolute;border-radius:50%;filter:blur(80px);opacity:.3;animation:orbFloat 25s ease-in-out infinite}
.orb-1{width:340px;height:340px;background:var(--primary);top:-80px;right:-60px;animation-delay:0s}
.orb-2{width:280px;height:280px;background:var(--accent);bottom:5%;left:-80px;opacity:.2;animation-delay:-8s}
.orb-3{width:200px;height:200px;background:var(--accent-2);top:40%;right:20%;opacity:.15;animation-delay:-16s}
@keyframes orbFloat{
  0%,100%{transform:translate(0,0) scale(1)}
  33%{transform:translate(40px,-40px) scale(1.1)}
  66%{transform:translate(-30px,30px) scale(.9)}
}

/* ===== App Shell ===== */
.app{position:relative;z-index:1;display:flex;flex-direction:column;height:100vh;height:100dvh;overflow:hidden}

/* ===== Views ===== */
.view{display:none;flex-direction:column;flex:1;overflow:hidden;animation:viewIn .35s ease}
.view.active{display:flex}
@keyframes viewIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

/* ===== Top Bar ===== */
.topbar{
  display:flex;align-items:center;justify-content:space-between;
  padding:12px 16px;
  background:var(--bg-glass);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
  z-index:10;flex-shrink:0;
}
.topbar-title{font-size:1.1rem;font-weight:700}
.topbar-btn{
  width:44px;height:44px;display:flex;align-items:center;justify-content:center;
  background:var(--bg-input);border:none;border-radius:14px;color:var(--text-2);
  transition:all .2s
}
.topbar-btn:active{transform:scale(.92)}
.topbar-btn svg{width:22px;height:22px}

/* Level Badge */
.topbar-right{display:flex;align-items:center;gap:10px}
.level-badge{
  width:40px;height:40px;border-radius:14px;
  background:linear-gradient(135deg,var(--primary),#818cf8);
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 4px 12px var(--primary-glow);
}
.level-num{color:#fff;font-weight:800;font-size:1.1rem}
.xp-info{display:flex;flex-direction:column;gap:3px}
.xp-label{font-size:.7rem;font-weight:600;color:var(--text-2);direction:ltr;text-align:left}
.xp-bar{width:80px;height:6px;background:var(--bg-input);border-radius:3px;overflow:hidden}
.xp-fill{height:100%;background:linear-gradient(90deg,var(--primary),var(--accent));border-radius:3px;transition:width .6s ease;width:0}

/* Streak Badge */
.topbar-left{display:flex;align-items:center}
.streak-badge{
  display:flex;align-items:center;gap:4px;
  background:var(--bg-input);padding:6px 14px;border-radius:20px;
  font-weight:700;font-size:.95rem
}
.streak-fire{font-size:1.1rem}

/* ===== Home ===== */
.home-scroll{flex:1;overflow-y:auto;padding:0 16px 100px;-webkit-overflow-scrolling:touch}

.hero{
  text-align:center;padding:28px 20px 24px;
  background:linear-gradient(135deg,var(--primary),#818cf8,var(--accent));
  border-radius:24px;margin:16px 0;color:#fff;
  box-shadow:var(--shadow-float);position:relative;overflow:hidden;
}
.hero::after{
  content:'';position:absolute;inset:0;
  background:radial-gradient(circle at 30% 20%,rgba(255,255,255,.2),transparent 60%);
}
.hero-avatar{font-size:3rem;margin-bottom:8px;position:relative;z-index:1;animation:heroFloat 3s ease-in-out infinite}
@keyframes heroFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.hero h1{font-size:1.6rem;font-weight:800;position:relative;z-index:1}
.hero p{font-size:.9rem;opacity:.9;margin-top:4px;position:relative;z-index:1}

.section-title{display:flex;justify-content:space-between;align-items:center;padding:20px 4px 12px;font-weight:700;font-size:1rem}
.topic-count{font-size:.8rem;font-weight:600;color:var(--text-3);background:var(--bg-input);padding:4px 12px;border-radius:12px}

/* ===== Topic Cards ===== */
.topics-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
@media(min-width:480px){.topics-grid{grid-template-columns:repeat(3,1fr);gap:14px}}
@media(min-width:768px){.topics-grid{grid-template-columns:repeat(4,1fr)}}

.topic-card{
  position:relative;display:flex;flex-direction:column;align-items:center;
  padding:22px 12px 18px;
  background:var(--bg-card);border-radius:20px;
  border:2px solid transparent;
  box-shadow:var(--shadow-card);
  transition:all .25s ease;overflow:hidden;
  animation:cardIn .4s ease backwards;
}
.topic-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:4px;
  border-radius:20px 20px 0 0;
  transition:height .3s ease;
}
.topic-card:active{transform:scale(.95)}
@media(hover:hover){
  .topic-card:hover{transform:translateY(-6px);box-shadow:var(--shadow-float);border-color:var(--primary)}
  .topic-card:hover::before{height:6px}
  .topic-card:hover .topic-icon{transform:scale(1.15) rotate(-5deg)}
}
@keyframes cardIn{from{opacity:0;transform:translateY(20px)}}

.topic-icon{font-size:2.5rem;margin-bottom:8px;transition:transform .3s ease}
.topic-label{font-size:.82rem;font-weight:600;color:var(--text-1);text-align:center}
.topic-check{
  position:absolute;top:10px;left:10px;width:22px;height:22px;
  background:var(--success);border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  color:#fff;font-size:.7rem;font-weight:700;
  box-shadow:0 2px 8px rgba(34,197,94,.3)
}

/* Card color accents */
.topic-card[data-color="blue"]::before{background:linear-gradient(90deg,#6366f1,#818cf8)}
.topic-card[data-color="pink"]::before{background:linear-gradient(90deg,#ec4899,#f472b6)}
.topic-card[data-color="orange"]::before{background:linear-gradient(90deg,#f97316,#fb923c)}
.topic-card[data-color="green"]::before{background:linear-gradient(90deg,#22c55e,#4ade80)}
.topic-card[data-color="cyan"]::before{background:linear-gradient(90deg,#06b6d4,#22d3ee)}
.topic-card[data-color="purple"]::before{background:linear-gradient(90deg,#a855f7,#c084fc)}
.topic-card[data-color="red"]::before{background:linear-gradient(90deg,#ef4444,#f87171)}
.topic-card[data-color="yellow"]::before{background:linear-gradient(90deg,#eab308,#facc15)}

/* ===== Lesson View ===== */
.topbar-lesson{gap:12px}
.lesson-topbar-center{flex:1}
.topbar-progress{height:10px;background:var(--bg-input);border-radius:5px;overflow:hidden}
.topbar-progress-fill{height:100%;background:linear-gradient(90deg,var(--primary),var(--accent));border-radius:5px;transition:width .5s ease;width:0}
.topbar-stats{display:flex;gap:12px}
.mini-stat{font-size:.8rem;color:var(--text-2);white-space:nowrap}
.mini-stat b{color:var(--text-1);font-weight:700}

.lesson-scroll{flex:1;overflow-y:auto;padding:16px 16px 100px;display:flex;flex-direction:column;gap:16px;-webkit-overflow-scrolling:touch}

.step-badge{
  align-self:center;
  background:var(--bg-card);padding:6px 20px;border-radius:20px;
  font-size:.8rem;font-weight:600;color:var(--text-2);
  box-shadow:var(--shadow-card);
}

/* Sentence Card */
.sentence-card{
  position:relative;
  background:var(--bg-card);border-radius:24px;
  padding:32px 24px 24px;text-align:center;
  box-shadow:var(--shadow-card);
  border:1px solid var(--border);
  overflow:hidden;
}
.sentence-card-glow{
  position:absolute;top:-40px;left:50%;transform:translateX(-50%);
  width:200px;height:80px;
  background:radial-gradient(ellipse,var(--primary-glow),transparent 70%);
  opacity:0;transition:opacity .4s;pointer-events:none;
}
.sentence-card.glow .sentence-card-glow{opacity:1}
.sentence-card.success-glow{animation:cardSuccess .7s ease}
.sentence-card.partial-glow{animation:cardPartial .5s ease}
@keyframes cardSuccess{
  0%,100%{box-shadow:var(--shadow-card)}
  50%{box-shadow:0 0 0 6px rgba(34,197,94,.2),0 0 30px rgba(34,197,94,.15),var(--shadow-card)}
}
@keyframes cardPartial{
  0%,100%{box-shadow:var(--shadow-card)}
  50%{box-shadow:0 0 0 6px rgba(245,158,11,.2),var(--shadow-card)}
}

.sentence-label{font-size:.85rem;color:var(--text-3);margin-bottom:16px;font-weight:500}
.sentence-english{
  font-size:1.6rem;font-weight:700;line-height:1.5;
  color:var(--text-1);margin-bottom:12px;
  direction:ltr;text-align:center;
}
.sentence-hebrew{font-size:1rem;color:var(--text-2);margin-bottom:20px;line-height:1.5}

.replay-btn{
  display:inline-flex;align-items:center;gap:8px;
  padding:10px 22px;border-radius:14px;
  background:var(--bg-input);border:none;
  color:var(--text-2);font-size:.85rem;font-weight:500;
  transition:all .2s
}
.replay-btn:active{transform:scale(.95)}
.replay-btn svg{width:16px;height:16px}
@media(hover:hover){.replay-btn:hover{background:var(--primary);color:#fff}}

/* Feedback */
.feedback-container{min-height:20px}
.feedback-box{
  padding:16px 20px;border-radius:18px;text-align:center;
  animation:feedIn .3s ease;
}
@keyframes feedIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.feedback-box.correct{background:var(--success-bg);color:var(--success)}
.feedback-box.partial{background:var(--warning-bg);color:var(--warning)}
.feedback-box.wrong{background:var(--danger-bg);color:var(--danger)}
.feedback-icon{font-size:1.8rem;margin-bottom:4px}
.feedback-text{font-size:1.05rem;font-weight:700;margin-bottom:6px}
.feedback-heard{font-size:.82rem;opacity:.75;direction:ltr}
.word-ok{color:var(--success);font-weight:700}
.word-miss{color:var(--danger);text-decoration:underline wavy;font-weight:700}

/* ===== Action Area ===== */
.action-area{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:220px}
.state{display:flex;flex-direction:column;align-items:center;gap:16px}
.state-text{font-size:1rem;color:var(--text-2);font-weight:600}

/* Listening */
.listening-visual{
  position:relative;width:110px;height:110px;
  display:flex;align-items:center;justify-content:center;
}
.listen-ear{font-size:3.5rem;position:relative;z-index:2;animation:earBounce 1.5s ease-in-out infinite}
@keyframes earBounce{0%,100%{transform:rotate(-5deg) scale(1)}50%{transform:rotate(5deg) scale(1.1)}}
.listen-ring{
  position:absolute;inset:0;border-radius:50%;
  border:2px solid var(--warning);opacity:0;
  animation:ringPulse 2s ease-out infinite;
}
.ring-2{animation-delay:.4s}
.ring-3{animation-delay:.8s}
@keyframes ringPulse{
  0%{transform:scale(.5);opacity:.7}
  100%{transform:scale(1.3);opacity:0}
}

/* Speaking / Mic */
.mic-orb{position:relative;width:110px;height:110px;display:flex;align-items:center;justify-content:center}
.mic-core{
  width:80px;height:80px;border-radius:50%;
  background:linear-gradient(135deg,var(--primary),#818cf8);
  display:flex;align-items:center;justify-content:center;
  color:#fff;position:relative;z-index:2;
  box-shadow:var(--shadow-glow);
}
.mic-core svg{width:36px;height:36px}
.mic-pulse{
  position:absolute;inset:0;border-radius:50%;
  background:var(--primary);opacity:.2;
  animation:micPulse 1.5s ease-out infinite;
}
.mic-pulse-2{animation-delay:.5s}
@keyframes micPulse{
  0%{transform:scale(.8);opacity:.3}
  100%{transform:scale(1.5);opacity:0}
}

.waveform{display:flex;align-items:center;gap:4px;height:40px}
.waveform span{
  width:5px;border-radius:3px;
  background:linear-gradient(180deg,var(--primary),var(--accent));
  animation:wave .5s ease-in-out infinite alternate;
}
.waveform span:nth-child(1){height:10px;animation-delay:0s}
.waveform span:nth-child(2){height:22px;animation-delay:.07s}
.waveform span:nth-child(3){height:30px;animation-delay:.14s}
.waveform span:nth-child(4){height:26px;animation-delay:.21s}
.waveform span:nth-child(5){height:34px;animation-delay:.28s}
.waveform span:nth-child(6){height:26px;animation-delay:.35s}
.waveform span:nth-child(7){height:30px;animation-delay:.42s}
.waveform span:nth-child(8){height:22px;animation-delay:.49s}
.waveform span:nth-child(9){height:10px;animation-delay:.56s}
@keyframes wave{from{transform:scaleY(.35)}to{transform:scaleY(1)}}

/* Start Button */
.mic-start-btn{
  display:flex;flex-direction:column;align-items:center;gap:14px;
  padding:28px 56px;border-radius:28px;border:none;
  background:linear-gradient(135deg,var(--primary),#818cf8);
  color:#fff;font-size:1.1rem;font-weight:700;
  box-shadow:var(--shadow-float);
  transition:all .25s;position:relative;overflow:hidden;
}
.mic-start-btn::after{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,transparent 40%,rgba(255,255,255,.15) 50%,transparent 60%);
  transform:translateX(-100%);transition:transform .6s;
}
.mic-start-btn:active{transform:scale(.95)}
@media(hover:hover){
  .mic-start-btn:hover{transform:translateY(-4px);box-shadow:0 12px 40px var(--primary-glow)}
  .mic-start-btn:hover::after{transform:translateX(100%)}
}
.mic-start-icon{
  width:64px;height:64px;border-radius:50%;
  background:rgba(255,255,255,.2);
  display:flex;align-items:center;justify-content:center;
}
.mic-start-icon svg{width:32px;height:32px}

/* Skip */
.skip-btn{
  align-self:center;padding:10px 28px;border-radius:14px;
  background:var(--bg-card);border:1px solid var(--border);
  color:var(--text-3);font-size:.85rem;font-weight:500;
  box-shadow:var(--shadow-card);transition:all .2s
}
.skip-btn:active{transform:scale(.95)}

/* ===== Complete View ===== */
.view-complete{align-items:center;justify-content:center;padding:24px}
.complete-content{text-align:center;max-width:400px;width:100%}
.complete-trophy{font-size:5rem;animation:trophyBounce .8s ease;margin-bottom:12px}
@keyframes trophyBounce{
  0%{transform:scale(0) rotate(-20deg);opacity:0}
  60%{transform:scale(1.2) rotate(5deg);opacity:1}
  100%{transform:scale(1) rotate(0)}
}
.complete-content h2{font-size:2rem;font-weight:800;color:var(--primary);margin-bottom:8px}
.complete-sub{color:var(--text-2);margin-bottom:28px}

.result-cards{display:flex;gap:12px;margin-bottom:32px}
.result-card{
  flex:1;padding:20px 12px;border-radius:20px;
  background:var(--bg-card);box-shadow:var(--shadow-card);
  display:flex;flex-direction:column;align-items:center;gap:6px;
  animation:resultIn .5s ease backwards;
}
.result-card:nth-child(2){animation-delay:.1s}
.result-card:nth-child(3){animation-delay:.2s}
@keyframes resultIn{from{opacity:0;transform:translateY(20px)}}
.result-icon{font-size:1.8rem}
.result-value{font-size:1.6rem;font-weight:800;color:var(--primary)}
.result-label{font-size:.75rem;font-weight:600;color:var(--text-3);text-transform:uppercase;letter-spacing:.5px}

.btn-continue{
  padding:16px 56px;border-radius:18px;border:none;
  background:linear-gradient(135deg,var(--primary),#818cf8);
  color:#fff;font-size:1.1rem;font-weight:700;
  box-shadow:var(--shadow-float);transition:all .25s
}
.btn-continue:active{transform:scale(.95)}
@media(hover:hover){.btn-continue:hover{transform:translateY(-3px)}}

/* ===== Settings ===== */
.settings-scroll{flex:1;overflow-y:auto;padding:16px 16px 100px}
.settings-group{margin-bottom:24px}
.settings-group-title{font-size:.75rem;font-weight:700;color:var(--text-3);text-transform:uppercase;letter-spacing:1px;padding:0 4px 10px}
.setting-row{
  display:flex;align-items:center;justify-content:space-between;
  padding:16px;background:var(--bg-card);
  border-bottom:1px solid var(--border);
}
.setting-row:first-of-type{border-radius:16px 16px 0 0}
.setting-row:last-of-type{border-radius:0 0 16px 16px;border-bottom:none}
.setting-row:only-of-type{border-radius:16px}
.setting-info{display:flex;align-items:center;gap:12px;font-weight:500}
.setting-icon{font-size:1.3rem}
.setting-action{display:flex;align-items:center;gap:10px}

.range-input{width:100px;accent-color:var(--primary)}
.range-val{font-size:.8rem;color:var(--text-3);min-width:42px;text-align:left;direction:ltr}

.toggle{
  position:relative;width:52px;height:30px;
  background:var(--bg-input);border:none;border-radius:15px;
  transition:background .2s;
}
.toggle.active{background:var(--primary)}
.toggle-knob{
  position:absolute;top:3px;left:3px;width:24px;height:24px;
  background:#fff;border-radius:50%;box-shadow:0 1px 4px rgba(0,0,0,.15);
  transition:transform .2s
}
.toggle.active .toggle-knob{transform:translateX(22px)}

.btn-reset{
  padding:8px 20px;border-radius:12px;border:none;
  background:var(--danger);color:#fff;font-size:.82rem;font-weight:600;
  transition:all .2s
}
.btn-reset:active{transform:scale(.95)}

/* ===== Bottom Nav ===== */
.bottom-nav{
  position:fixed;bottom:0;left:0;right:0;z-index:50;
  display:flex;justify-content:space-around;
  background:var(--bg-glass);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  border-top:1px solid var(--border);
  padding:8px 0;padding-bottom:max(8px,env(safe-area-inset-bottom));
}
.nav-item{
  display:flex;flex-direction:column;align-items:center;gap:4px;
  background:none;border:none;color:var(--text-3);
  font-size:.65rem;font-weight:600;padding:6px 24px;
  border-radius:12px;transition:all .2s;
}
.nav-item svg{width:24px;height:24px}
.nav-item.active{color:var(--primary)}
.nav-item:active{transform:scale(.9)}

/* ===== No Support ===== */
.no-support{position:fixed;inset:0;z-index:999;display:flex;align-items:center;justify-content:center;background:var(--bg-body)}
.no-support-inner{text-align:center;padding:40px}
.no-support-inner h2{font-size:1.4rem;color:var(--danger);margin:16px 0 8px}
.no-support-inner p{color:var(--text-2)}

/* ===== Confetti ===== */
#confettiCanvas{position:fixed;inset:0;pointer-events:none;z-index:200}

/* ===== Shake ===== */
@keyframes shake{
  0%,100%{transform:translateX(0)}
  20%{transform:translateX(-8px)}
  40%{transform:translateX(8px)}
  60%{transform:translateX(-4px)}
  80%{transform:translateX(4px)}
}
.shake{animation:shake .5s ease}

/* ===== Responsive ===== */
@media(max-width:360px){
  .sentence-english{font-size:1.3rem}
  .hero h1{font-size:1.3rem}
  .result-cards{flex-direction:column}
}
